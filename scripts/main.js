let red = 'https://i.imgur.com/rnGgDAu.png';
let green = 'https://i.imgur.com/yfxHLoG.png';

let red_data = "data:image/svg+xml,%3Csvg version='1.1' id='Layer_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='100%25' viewBox='0 0 155 158' enable-background='new 0 0 155 158' xml:space='preserve'%3E%3Cpath fill='%23B2081A' opacity='1.000000' stroke='none' d='%0AM68.000000,159.000000 C45.333336,159.000000 23.166672,159.000000 1.000006,159.000000 C1.000004,106.333344 1.000004,53.666683 1.000002,1.000020 C52.666653,1.000013 104.333305,1.000013 155.999969,1.000007 C155.999969,53.666645 155.999969,106.333290 155.999985,158.999969 C126.833336,159.000000 97.666664,159.000000 68.000000,159.000000 M58.052406,131.005585 C61.392399,131.687714 62.217556,129.282898 63.236046,126.925331 C70.665154,109.728661 78.151558,92.556747 85.598473,75.367752 C88.312683,69.102837 90.968758,62.812737 93.881973,55.994370 C87.629791,55.994370 82.289543,56.297680 77.003593,55.892502 C73.196342,55.600674 71.803131,57.340710 70.572876,60.485939 C67.094070,69.379784 63.329834,78.161980 59.469158,87.493011 C58.527885,85.750305 57.716045,84.506866 57.151669,83.159744 C53.759541,75.062988 50.477165,66.919662 47.009350,58.855869 C46.523094,57.725166 45.249962,56.164043 44.292294,56.128841 C37.753860,55.888481 31.202381,56.002895 24.156660,56.002895 C25.557673,59.303795 26.615799,61.891232 27.746958,64.446342 C34.192047,79.004745 40.741539,93.518272 46.999413,108.156540 C47.768936,109.956581 47.560368,112.610855 46.858139,114.521194 C44.850544,119.982620 42.355122,125.264725 39.884464,131.005615 C46.154041,131.005615 51.649353,131.005615 58.052406,131.005585 M101.649788,59.091141 C98.588806,65.950920 95.527832,72.810692 92.179077,80.315384 C100.209000,80.315384 107.176468,80.409454 114.136391,80.222755 C115.296165,80.191643 117.020218,79.210640 117.475830,78.209824 C124.402061,62.995270 131.160278,47.704224 138.241348,31.793869 C130.856613,31.793869 124.094879,31.954117 117.347015,31.717829 C114.504967,31.618311 113.236206,32.717224 112.194183,35.172642 C108.889618,42.959526 105.371513,50.655792 101.649788,59.091141 M86.304550,91.957817 C83.345825,98.952072 84.600662,104.603722 89.933876,108.303810 C95.186600,111.948044 102.698189,111.511093 107.502548,107.281845 C112.019928,103.305237 113.148277,97.058022 110.279724,91.905670 C107.263115,86.487389 100.167419,83.750313 93.825638,86.189697 C91.190361,87.203369 89.086487,89.598579 86.304550,91.957817 z'/%3E%3Cpath fill='%23FEFBFC' opacity='1.000000' stroke='none' d='%0AM57.598537,131.005600 C51.649353,131.005615 46.154041,131.005615 39.884464,131.005615 C42.355122,125.264725 44.850544,119.982620 46.858139,114.521194 C47.560368,112.610855 47.768936,109.956581 46.999413,108.156540 C40.741539,93.518272 34.192047,79.004745 27.746958,64.446342 C26.615799,61.891232 25.557673,59.303795 24.156660,56.002895 C31.202381,56.002895 37.753860,55.888481 44.292294,56.128841 C45.249962,56.164043 46.523094,57.725166 47.009350,58.855869 C50.477165,66.919662 53.759541,75.062988 57.151669,83.159744 C57.716045,84.506866 58.527885,85.750305 59.469158,87.493011 C63.329834,78.161980 67.094070,69.379784 70.572876,60.485939 C71.803131,57.340710 73.196342,55.600674 77.003593,55.892502 C82.289543,56.297680 87.629791,55.994370 93.881973,55.994370 C90.968758,62.812737 88.312683,69.102837 85.598473,75.367752 C78.151558,92.556747 70.665154,109.728661 63.236046,126.925331 C62.217556,129.282898 61.392399,131.687714 57.598537,131.005600 z'/%3E%3Cpath fill='%23FEFCFC' opacity='1.000000' stroke='none' d='%0AM101.792877,58.739117 C105.371513,50.655792 108.889618,42.959526 112.194183,35.172642 C113.236206,32.717224 114.504967,31.618311 117.347015,31.717829 C124.094879,31.954117 130.856613,31.793869 138.241348,31.793869 C131.160278,47.704224 124.402061,62.995270 117.475830,78.209824 C117.020218,79.210640 115.296165,80.191643 114.136391,80.222755 C107.176468,80.409454 100.209000,80.315384 92.179077,80.315384 C95.527832,72.810692 98.588806,65.950920 101.792877,58.739117 z'/%3E%3Cpath fill='%23FDFAFA' opacity='1.000000' stroke='none' d='%0AM86.522751,91.661682 C89.086487,89.598579 91.190361,87.203369 93.825638,86.189697 C100.167419,83.750313 107.263115,86.487389 110.279724,91.905670 C113.148277,97.058022 112.019928,103.305237 107.502548,107.281845 C102.698189,111.511093 95.186600,111.948044 89.933876,108.303810 C84.600662,104.603722 83.345825,98.952072 86.522751,91.661682 z'/%3E%3C/svg%3E"

let green_data = "data:image/svg+xml,%3Csvg version='1.1' id='Layer_1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' x='0px' y='0px' width='100%25' viewBox='0 0 153 156' enable-background='new 0 0 153 156' xml:space='preserve'%3E%3Cpath fill='%23146A56' opacity='1.000000' stroke='none' d='%0AM67.000000,157.000000 C44.666668,157.000000 22.833338,157.000000 1.000006,157.000000 C1.000004,105.000008 1.000004,53.000019 1.000002,1.000020 C51.999985,1.000013 102.999969,1.000013 153.999969,1.000007 C153.999969,52.999981 153.999969,104.999962 153.999985,156.999969 C125.166664,157.000000 96.333336,157.000000 67.000000,157.000000 M61.618786,126.355659 C71.965492,102.427498 82.312202,78.499344 92.909424,53.991833 C86.678162,53.991833 81.343018,54.286301 76.059219,53.892288 C72.295250,53.611614 70.825905,55.266994 69.587326,58.433315 C66.104958,67.335747 62.337456,76.126640 58.472179,85.469620 C57.532009,83.736084 56.719017,82.499039 56.156555,81.156998 C52.763607,73.061302 49.481144,64.918716 46.012577,56.855980 C45.525772,55.724392 44.250206,54.163189 43.290859,54.127846 C36.757030,53.887115 30.210106,54.001835 23.154760,54.001835 C24.562433,57.318935 25.620972,59.907711 26.752529,62.464161 C33.195980,77.021454 39.744255,91.533669 45.999554,106.171188 C46.768845,107.971336 46.549519,110.626999 45.847126,112.540764 C43.846264,117.992371 41.359100,123.265495 38.891872,129.007858 C45.526237,129.007858 51.357182,129.128448 57.176178,128.918274 C58.534428,128.869202 59.852127,127.697372 61.618786,126.355659 M99.733681,59.171249 C96.977798,65.322723 94.221924,71.474205 91.155670,78.318489 C98.534546,78.318489 104.992401,78.155586 111.435860,78.389328 C114.515678,78.501045 116.094421,77.610413 117.355728,74.642403 C122.413300,62.741360 127.800896,50.980576 133.065689,39.167580 C134.381699,36.214794 135.694809,33.260727 137.237930,29.793415 C129.817078,29.793415 123.176460,29.973179 116.553101,29.713295 C113.499710,29.593491 112.179855,30.810190 111.065872,33.439156 C107.508430,41.834660 103.706566,50.126595 99.733681,59.171249 M102.112213,107.904846 C103.409927,107.175758 104.823273,106.595451 105.985626,105.692177 C111.440063,101.453430 112.431656,93.682793 108.279762,88.397171 C103.727722,82.602142 94.530884,81.636566 88.588882,86.329819 C82.976303,90.762894 81.880096,98.785690 86.422096,103.992111 C90.411064,108.564613 95.545250,109.726318 102.112213,107.904846 z'/%3E%3Cpath fill='%23FBFCFC' opacity='1.000000' stroke='none' d='%0AM61.403637,126.698898 C59.852127,127.697372 58.534428,128.869202 57.176178,128.918274 C51.357182,129.128448 45.526237,129.007858 38.891872,129.007858 C41.359100,123.265495 43.846264,117.992371 45.847126,112.540764 C46.549519,110.626999 46.768845,107.971336 45.999554,106.171188 C39.744255,91.533669 33.195980,77.021454 26.752529,62.464161 C25.620972,59.907711 24.562433,57.318935 23.154760,54.001835 C30.210106,54.001835 36.757030,53.887115 43.290859,54.127846 C44.250206,54.163189 45.525772,55.724392 46.012577,56.855980 C49.481144,64.918716 52.763607,73.061302 56.156555,81.156998 C56.719017,82.499039 57.532009,83.736084 58.472179,85.469620 C62.337456,76.126640 66.104958,67.335747 69.587326,58.433315 C70.825905,55.266994 72.295250,53.611614 76.059219,53.892288 C81.343018,54.286301 86.678162,53.991833 92.909424,53.991833 C82.312202,78.499344 71.965492,102.427498 61.403637,126.698898 z'/%3E%3Cpath fill='%23FDFDFD' opacity='1.000000' stroke='none' d='%0AM99.866379,58.814888 C103.706566,50.126595 107.508430,41.834660 111.065872,33.439156 C112.179855,30.810190 113.499710,29.593491 116.553101,29.713295 C123.176460,29.973179 129.817078,29.793415 137.237930,29.793415 C135.694809,33.260727 134.381699,36.214794 133.065689,39.167580 C127.800896,50.980576 122.413300,62.741360 117.355728,74.642403 C116.094421,77.610413 114.515678,78.501045 111.435860,78.389328 C104.992401,78.155586 98.534546,78.318489 91.155670,78.318489 C94.221924,71.474205 96.977798,65.322723 99.866379,58.814888 z'/%3E%3Cpath fill='%23FAFCFC' opacity='1.000000' stroke='none' d='%0AM101.728455,107.997353 C95.545250,109.726318 90.411064,108.564613 86.422096,103.992111 C81.880096,98.785690 82.976303,90.762894 88.588882,86.329819 C94.530884,81.636566 103.727722,82.602142 108.279762,88.397171 C112.431656,93.682793 111.440063,101.453430 105.985626,105.692177 C104.823273,106.595451 103.409927,107.175758 101.728455,107.997353 z'/%3E%3C/svg%3E";

const GainState = Object.freeze({
    UNDEFINED: 0,
    POSITIVE: 1,
    NEGATIVE: 2
});

let mainLoop = () => {
  let gainState = tryOldGainState();
  if (gainState == GainState.UNDEFINED) {
    gainState = tryNewGainState();
  }
  if (!gainState || gainState == GainState.UNDEFINED) {
    return;
  }
  updateIcons(gainState);
};

let tryOldGainState = () => {
  let dayGainEl = Array.from(document.querySelectorAll('div')).find(el => el.textContent === 'Day Gain');
  if (!dayGainEl) {
    return GainState.UNDEFINED;
  }
  let dayGain = dayGainEl.parentElement.childNodes[1].innerHTML.includes('positiveColor');
  if (dayGain) {
    return GainState.POSITIVE;
  }
  return GainState.NEGATIVE;
};

let tryNewGainState = () => {
  let dayGainEl = Array.from(document.querySelectorAll('h4')).find(el => el.textContent === 'Day Change');
  if (!dayGainEl) {
    return GainState.UNDEFINED;
  }
  let dayGain = dayGainEl.parentElement.parentElement.childNodes[2].outerHTML.includes('txt-positive');
  if (dayGain) {
    return GainState.POSITIVE;
  }
  return GainState.NEGATIVE;
};

let updateIcons = (gainState) => {
  let oldIcons = document.querySelectorAll('link[rel*="icon"]');
  let newIcon = document.createElement('link');
  newIcon.rel = 'icon';
  if (gainState == GainState.POSITIVE) {
    newIcon.href = green_data;
  } else {
    newIcon.href = red_data;
  }
  for (let i=0; i < oldIcons.length; i++) {
    document.head.removeChild(oldIcons[i]);
  }
  document.head.appendChild(newIcon);
};
  

setInterval(mainLoop, 3000);

